---
problem_type: process
cmdline: "watch"
title:  "Задача: Периодично извикване на програма"
---
0. Условие на задачата

   0. Основна функционалност

      Целта на задачата е да се реализира проста команда `{{ page.cmdline }}`.

      На командния ред на `{{ page.cmdline }}` се подава друга команда, която трябва да се изпълнява периодично - на всеки 2 секунди.

      Например, ако програмата ви се извика по следния начин:
      ```
      ./watch date
      ```
      то на всеки 2 секунди трябва да се извиква командата `date`. Отброяването на 2-те секунди започва след приключването на предходното извикване на подадената команда.
      ```
      Sun  5 Jun 02:37:15 UTC 2018
      Sun  5 Jun 02:37:17 UTC 2018
      Sun  5 Jun 02:37:19 UTC 2018
      Sun  5 Jun 02:37:21 UTC 2018
      ...
      ```

      Програмата ви не трябва да приключва, а трябва да извиква подадената команда постоянно.

   0. Поддръжка на множество аргументи

      На командия ред може да бъде подаден повече от един аргумент - допълнителни аргументи на подадената команда. Вашата програма трябва да предаде допълнителните аргументи на извикваната програма, така както са подадени на вашата.

      Например, ако програмата ви се извика по следния начин:
      ```
      ./watch date -I
      ```
      то на всеки 2 секунди трябва да се извиква командата `date` с аргумент `-I`.
      ```
      2018-06-05
      2018-06-05
      2018-06-05
      2018-06-05
      2018-06-05
      ...
      ```

   0. Обработка на грешки

      Ако подадения аргумент не е изпълнима команда, то програмата трябва да изведе съобщение за грешка.  Например, ако на командния ред на програмата се подаде `./aa` и в текущата директория няма файл с такова име, то програмата трябва да формира следното съобщение:
      ```
      ./watch ./aa
      ./aa: No such file or directory
      ./aa: No such file or directory
      ./aa: No such file or directory
      ./aa: No such file or directory
      ./aa: No such file or directory
      ...
      ```

      Ако `fork` не успее да създаде нов процес, то трябва да се изведе съобщение за грешка:
      ```
      ./watch ls
      fork: Cannot allocate memory
      fork: Cannot allocate memory
      fork: Cannot allocate memory
      fork: Cannot allocate memory
      fork: Cannot allocate memory
      ...
      ```

      В случай на грешка при изпълнение на дадена команда, то вашата програма не трябва да приключва.

   0. Допълнителни изисквания

      За изпълнение на подадените команди трябва да се използва комбинация от обръщания към функциите
      ```
      pid_t fork( void );
      ```
      и
      ```
      execv( const char *filename, char *const argv[] );
      ```

      След завършване на работата на създадения по този начин процес, родителския процес задължително трябва да провери статуса на завършване на детето като използва някой от вариантите на функциите `wait*`, например функцията
      ```
      pid_t waitpid( pid_t pid, int *status, int options );
      ```

{% include requirements-cmd.md %}
